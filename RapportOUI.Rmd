---
title: "Rapport de projet - Analyse de données"
author: "ALIX Claire - ZEGHARI Saad"
institute : "INSA Toulouse"
date: "`r Sys.Date()`"
output: 
  pdf_document :
    toc : TRUE
    toc_depth : 3
    number_section : TRUE
geometry: margin=0.7in
header-includes:
   - \usepackage{dsfont}
   - \usepackage{color}
   - \newcommand{\1}{\mathds{1}}
---

```{r setup, include=FALSE }
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning=FALSE,fig.align="center",fig.width=15,fig.height = 5, dpi=300)

#importation des packages utiles au projet
library(reticulate)
library(ggplot2)
library(corrplot)
library(FactoMineR)
library(factoextra)
library(gridExtra)
library(BioStatR)
library(reshape2)
library(forcats)
library(mclust)
library(cluster)
library(ppclust)
library(circlize)
library(ggalluvial)
library(clusterSim)
library(seriation)
library(knitr)
library(stringr)
```
\newpage
# Introduction

Dans ce projet, on s'intéresse à la population des gènes d'une plante modèle. On souhaite analyser un jeu de données représentant les différences d'expression d'un certain nombre de gènes pour plusieurs traitements appliqués et en tirer des conclusions pertinentes à propos l'expérience biologique menée.

Tout au long de ce rapport, le symbole {\textbf{\textsf{R}}} indique que des informations disponibles dans le code ne sont pas transmises dans le rapport.

# Statistiques descriptives

## Description du jeu de données

```{r,eval=T, echo=FALSE}
#On récupère le jeu de données
data<-read.table("DataProjet3MIC-2425.txt",header=T, sep=";", stringsAsFactors = T)
```
Afin de décrire l'ensemble du jeu de données, nous avons utilisé quelques commandes {\textbf{\textsf{R}}}.
```{r,eval=T, echo=FALSE, results='hide'}
#commandes utiles pour l'analyse du jeu de données
head(data)
str(data)
names(data)
colnames(data)
attributes(data)
```
Le jeu de données fourni est composé d'un échantillon de 542 individus qui correspondent aux gènes de la plante modèle et comporte 39 variables statistiques qui caractérisent les individus. 

Grace à la commande `str(data)`, on observe que les 36 premières variables sont des variables quantitatives continues (variables nommées Tt_sH_Rr). Ces variables permettent d'évaluer les divergences d'expression des gènes pour trois traitements appliqués (T1, T2 et T3) par rapport à un état sans traitement de référence. Les données de chaque traitement ont été relevées durant 6 heures et ceci pour deux réplicats biologiques (R1 et R2).

Les trois dernières variables (nommées ExpT1, ExpT2 et ExpT3) sont des variables qualitatives nominales dont les trois modalités sont : "Non", "Sous" et "Sur". Ces dernières représentent la décision si le gène est sur-exprimé, sous-exprimé ou non-exprimé à 6 heures par rapport à l'état de référence, pour chaque traitement.

Afin de visualiser les données, les premières lignes du jeu de données sont affichées dans la Table \ref{tab:tabdata}. 
En raison de la grande quantité de données, nous avons choisi de représenter seulement les variables T1_1H_R1 à T1_6H_R1 et ExpT1 qui donnent un aperçu de la structure du jeu de données pour le réplicat R1.

```{r, echo=FALSE, eval=TRUE}
kable(head(data[,c(1:6,37)]),caption="\\label{tab:tabdata}Les premières lignes du jeu de données.")
```

## Analyse uni-dimensionnelle

Nous commençons par faire quelques statistiques descriptives uni-dimensionnelles afin de prendre en main le jeu de données. {\textbf{\textsf{R}}}

### Variables qualitatives

```{r echo=FALSE, eval=FALSE}
#Visualisation des modalités des trois variables qualitatives
levels(data$ExpT1)
levels(data$ExpT2)
levels(data$ExpT3)
```

Nous avons à notre disposition trois variables qualitatives : ExpT1, ExpT2, ExpT3 comme décrites précédemment. Pour extraire certaines tendances des traitements appliqués, nous analysons les fréquences d'apparition des différentes modalités et nous les représentons sous forme de diagrammes en secteurs dans la Figure \ref{fig:diagsecteurs}.

```{r ,echo=F, eval=FALSE}
#Tableau des fréquences pour les variables qualitatives (non utilisé dans le rapport)

Eff1<-table(data$ExpT1)
#df1<-data.frame(Eff1=c(Eff1),Freq=c(Eff1)/sum(Eff1))
#knitr::kable(t(df1))

Eff2<-table(data$ExpT2)
#df2<-data.frame(Eff2=c(Eff2),Freq=c(Eff2)/sum(Eff2))
#knitr::kable(t(df2))

Eff3<-table(data$ExpT3)
#df3<-data.frame(Eff3=c(Eff3),Freq=c(Eff3)/sum(Eff3))
#knitr::kable(t(df3))

#On regroupe les trois variables dans un même tableau pour pouvoir comparer les traitements
df<-data.frame(ExpT1=round(c(Eff1)*100/sum(Eff1),digits = 3), ExpT2=round(c(Eff2)*100/sum(Eff2),digits=3), ExpT3=round(c(Eff3)*100/sum(Eff3),digits=3))
knitr::kable(t(df),caption="\\label{tab:tabfreq}Tableau des fréquences pour les variables qualitatives (en %)")
```

```{r, echo=FALSE, eval=FALSE}
#barplots des effectifs des variables qualitatives (non utilisé dans le rapport)
g1 = ggplot(data) + geom_bar(aes(x = ExpT1)) 
g2 = ggplot(data) + geom_bar(aes(x = ExpT2)) 
g3 = ggplot(data) + geom_bar(aes(x = ExpT3)) 
grid.arrange(g1,g2,g3,ncol=3)
```

```{r, echo=FALSE, eval=TRUE, fig.align='center', fig.cap="\\label{fig:diagsecteurs}Diagrammes en secteurs des fréquences des variables ExpT1, ExpT2 et ExpT3"}
#Diagrammes en secteurs des fréquences pour les variables qualitatives

#Pour ExpT1
df1 <- data.frame(group = levels(data$ExpT1), value = as.vector(table(data$ExpT1)) / nrow(data))
g1pie <- ggplot(df1, aes(x = "", y = value, fill = group)) + 
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start = 0) +
  geom_text(aes(label = scales::percent(value, accuracy = 0.1)), 
            position = position_stack(vjust = 0.7),  
            size = 6, family = "serif", fontface = "bold") +  #Changer la police
  theme_grey(base_size = 15) + 
  theme(
    panel.grid = element_line(color = "gray"),  #Lignes de la grille visibles
    legend.position = "bottom",
    plot.title = element_text(hjust = 0.5, family = "serif", size = 20, face = "bold")  #Centrer et styliser le titre
  ) +
  labs(fill = NULL) +
  ggtitle("ExpT1") 

#Pour ExpT2
df2 <- data.frame(group = levels(data$ExpT2), value = as.vector(table(data$ExpT2)) / nrow(data))
g2pie <- ggplot(df2, aes(x = "", y = value, fill = group)) + 
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start = 0) +
  geom_text(aes(label = scales::percent(value, accuracy = 0.1)), 
            position = position_stack(vjust = 0.7), 
            size = 6, family = "serif", fontface = "bold") +  #Changer la police
  theme_grey(base_size = 15) + 
  theme(
    panel.grid = element_line(color = "gray"),  #Lignes de la grille visibles
    axis.text.y = element_text(size = 10),       #Indicateurs autour du graphique
    legend.position = "bottom",
    plot.title = element_text(hjust = 0.5, family = "serif", size = 20, face = "bold")  #Centrer et styliser le titre
  ) +
  labs(fill = NULL) +
  ggtitle("ExpT2") 

#Pour ExpT3
df3 <- data.frame(group = levels(data$ExpT3), value = as.vector(table(data$ExpT3)) / nrow(data))
g3pie <- ggplot(df3, aes(x = "", y = value, fill = group)) + 
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start = 0) +
  geom_text(aes(label = scales::percent(value, accuracy = 0.1)), 
            position = position_stack(vjust = 0.7), 
            size = 6, family = "serif", fontface = "bold") +  # Changer la police
  theme_grey(base_size = 15) + 
  theme(
    panel.grid = element_line(color = "gray"),  #Lignes de la grille visibles
    axis.text.y = element_text(size = 10),
    legend.position = "bottom",
    plot.title = element_text(hjust = 0.5, family = "serif", size = 20, face = "bold")  #Centrer et styliser le titre
  ) +
  labs(fill = NULL) +
  ggtitle("ExpT3") 

#Disposition des graphiques
grid.arrange(g1pie, g2pie, g3pie, ncol = 3)

```
D'après la Figure \ref{fig:diagsecteurs}, on peut déjà remarquer que les traitements diffèrent dans la réaction des gènes. En effet, on observe une grande similarité entre les traitements T2 et T3 avec des réactions réparties de façon quasi-homogène entre les modalités "sous" et "sur" exprimé. Pour sa part, le traitement T1 n'a aucun effet sur la majorité des gènes, qui n'expriment pas de différence particulière par rapport à l'état de référence (81% de "non" exprimé pour ExpT1). Le traitement T1 pourrait ainsi être considéré comme moins efficace par rapport à T2 et T3. T2 semble être un traitement efficace, induisant des changements significatifs dans l'expression des gènes. Comme T3 est une combinaison de T1 et T2, ce traitement semble amplifier l'effet de T2 avec une réponse quasi-identique.


### Variables quantitatives

Nous analysons maintenant les variables quantitatives de notre jeu de données (variables Tt_sH_Rr) individuellement. 

Pour apréhender les différences entre les variables quantitatives et en raison du grand nombre de variables à analyser, nous avons décidé de tracer leurs boxplots respectifs, regroupés par variables d'un même réplicat dans la Figure \ref{fig:boxplots_quantitatives1} et la Figure \ref{fig:boxplots_quantitatives2}. Ceci nous permet de résumer les variables de manière simple et visuelle, d'identifier les valeurs extrêmes, de comprendre la répartition des observations et de comparer les deux réplicats. {\textbf{\textsf{R}}}

```{r,echo=F, fig.align="center", fig.width=15, fig.height = 5, fig.cap="\\label{fig:boxplots_quantitatives1}Boxplots des variables quantitatives du réplicat R1"}
#On sépare les boxplots des deux réplicats pour avoir des graphiques plus lisibles et comparables
data1 <- melt(data[, -c(19:39)])
ggplot(data1, aes(x = variable, y = value)) + geom_boxplot()
```

```{r,echo=F, fig.align="center", fig.width=15, fig.height = 5, fig.cap="\\label{fig:boxplots_quantitatives2}Boxplots des variables quantitatives du réplicat R2"}
data2 <- melt(data[, -c(1:18,37:39)])
ggplot(data2, aes(x = variable, y = value)) + geom_boxplot()
```
Lorsque l'on compare les boxplots obtenus sur les Figures \ref{fig:boxplots_quantitatives1} et \ref{fig:boxplots_quantitatives2}, on peut observer de grandes similitudes entre les résultats obtenus pour le réplicat R1 et ceux du réplicat R2, ce qui prouve une certaine cohérence de l'expérience menée et suggère une reproductibilité des résultats expérimentaux.

Nous pouvons également comparer les médianes et les écarts interquartiles respectifs des variables pour évaluer la dispersion centrale des données. On observe que les traitements T2 et T3 montrent des variances similaires et plus grandes, ce qui est visible sur boxplots plus étendus. Cela reflète une réponse plus variable des gènes pour ces traitements.

Pour T1, les médianes semblent plus proches de zéro, ce qui pourrait indiquer un effet moins marqué par rapport aux traitements T2 et T3 pour lesquels les médianes sont légèrement plus espacées.

Enfin, la présence de nombreux outliers sur les boxplots du traitement T1 peut indiquer que certains gènes réagissent de manière atypique à ce traitement.

```{r, echo=FALSE, eval=FALSE}
#On compare les indicateurs numériques (variances, médianes, moyennes) pour les variables quantitatives

# Calculer les variances pour chaque colonne (variables 1 à 36)
variances <- apply(data[, 1:36], 2, var)

variance_data <- data.frame(
  variable = names(variances),
  variance = variances
)

ggplot(variance_data, aes(x = variable, y = variance)) +
  geom_point(size = 2, color = "purple") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(
    title = "Graphique des variances par variable",
    x = "Variable",
    y = "Variance"
  )
```

```{r, echo=FALSE, eval=FALSE}
# Calculer les médianes pour chaque colonne (variables 1 à 36)
medians <- apply(data[, 1:36], 2, median)

median_data <- data.frame(
  variable = names(medians),
  median = medians
)

ggplot(median_data, aes(x = variable, y = median)) +
  geom_point(size = 2, color = "blue") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(
    title = "Graphique des médianes par variable",
    x = "Variable",
    y = "Médiane"
  )
```

```{r, echo=FALSE, eval=FALSE}
# Calculer les moyennes pour chaque colonne (variables 1 à 36)
means <- colMeans(data[, 1:36])

mean_data <- data.frame(
  variable = names(means),
  mean = means
)

ggplot(mean_data, aes(x = variable, y = mean)) +
  geom_point(size = 2, color = "red") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(
    title = "Graphique des moyennes par variable",
    x = "Variable",
    y = "Moyenne"
  )
```

## Analyse bi-dimensionnelle

Nous nous intéressons maintenant à l'analyse bi-dimensionnelle de toutes les variables du jeu de données. {\textbf{\textsf{R}}}

### Deux variables quantitatives

Nous commençons par analyser les variables quantitatives entre elles. Afin d'analyser les liaisons entre ces variables, nous affichons en Figure \ref{fig:matricecorrelations} la matrice des corrélations qui représente les coefficients de corrélations des variables deux à deux et mesure la dépendance linéaire des variables.

```{r ,echo=F,fig.align = "center", fig.width=20, fig.height = 10, fig.cap="\\label{fig:matricecorrelations}Matrice des corrélations des variables quantitatives"}
corrplot(cor(data[, -c(37:39)]), method = "ellipse")
```
D'après la Figure \ref{fig:matricecorrelations}, les corrélations sont fortes entre les variables des traitement T2 et T3, tandis que les variables du traitement T1 sont globalement peu corrélées aux autres variables, peu importe le réplicat considéré. De plus, la majorité des corrélations sont positives.

On observe une forte corrélation entre des variables équivalentes des réplicats R1 et R2 (par exemple les variables T2_6H_R1 et T2_6H_R2), ce qui indique à nouveau que les réplicats sont reproductibles.

Puisque T3 est une combinaison des traitements T1 et T2, nous devrions voir apparaitre des corrélations significatives entre T3 et les variables de T1 et T2. Or ce n'est le cas que pour T2, ce qui indique que le traitement T1 ne contribue qu'à une faible échelle au résultats du traitement T3.

Enfin, Les variables mesurant le même traitement (T1, T2, ou T3) à des heures différentes ou pour des réplicats différents  présentent des corrélations positives, les mesures sont donc probablement cohérentes.


### Deux variables qualitatives

Dans le cas de deux variables qualitatives, on représente les profils-ligne ou profils-colonne dans la Figure \ref{fig:profils_lignes}.

```{r, fig.height=5, fig.width=15, fig.cap="\\label{fig:profils_lignes}Profils-lignes des variables qualitatives"}
#Tableaux de contingence et profils-lignes des variables qualitatives

#prop.table(table(data$ExpT1,data$ExpT2),margin=1)
g1<-ggplot(data,aes(x=ExpT1,fill=ExpT2))+
geom_bar(position = "fill")

#prop.table(table(data$ExpT1,data$ExpT3),margin=1)
g2<-ggplot(data,aes(x=ExpT1,fill=ExpT3))+
geom_bar(position = "fill")

#prop.table(table(data$ExpT2,data$ExpT3),margin=1)
g3<-ggplot(data,aes(x=ExpT2,fill=ExpT3))+
geom_bar(position = "fill")

grid.arrange(g1,g2,g3,ncol=3)
```
Les profils-lignes montrent la répartition des modalités des variables qualitatives (ExpT1, ExpT2, ExpT3) et permet de comparer les résultats biologiques de décision obtenus par les trois traitements. L'analyse de la Figure \ref{fig:profils_lignes} montre à nouveau que les réponses des traitements T2 et T3 sont similaires avce une légère prépondérence de "sur" exprimé pour T3 et moins de "non" exprimé. De plus, T3 déclenche des réponses significatives sur plus de gènes que T2 ce qui concorde avec le fait que T3 est une combinaison des effets de T1 et T2. La similarité pourrait indiquer que l'effet de T2 domine dans la combinaison.

On peut également observer que les réponses des gènes au traitement T1 sont très différentes des réponses aux traitements T2 et T3. La majorité des gènes "sous" exprimés par le traitement T1 le restent avec les deux autres traitements mais les gènes "non" exprimé deviennent "sur" et "sous" exprimés par les traitements T2 et T3 avec des proportions similaires. De même, les gènes "sur" exprimés avec T1 se divisent dans les trois modalités pour les deux traitements restants.

Les profils ligne illustrent des tendances qualitatives cohérentes avec les boxplots de l'analyse uni-dimensionnelle. Par exemple, les distributions équilibrées des modalités "Sur" et "Sous" pour T2 et T3 sont en accord avec les variances plus importantes observées dans les boxplots.


### Une variable qualitative et une variable quantitative

Enfin, nous nous intéressons à l'analyse du degré de liaison de certaines variables quantitatives avec des variables qualitatives. La Figure \ref{fig:boxplots_paralleles} présente quelques boxplots parallèles. On trace la distribution des variables quantitatives à 6 heures pour chaque traitement et chaque réplicat en fonction de chaque modalité d'une variable qualitative ExpT1, ExpT2 ou ExpT3 correspondante.

Ces boxplots parallèles permettent d’explorer comment les valeurs des variables quantitatives diffèrent en fonction des catégories des variables qualitatives.

```{r, fig.align='center', fig.cap="\\label{fig:boxplots_paralleles}Boxplots parallèles de variables quantitatives en fonctiond des modalités des variables qualitatives"}

plot1<-ggplot(data,aes(x=ExpT1,y=T1_6H_R1 ))+geom_boxplot()
plot2<-ggplot(data,aes(x=ExpT2,y=T2_6H_R1))+geom_boxplot()
plot3<-ggplot(data,aes(x=ExpT3,y=T3_6H_R1 ))+geom_boxplot()
plot4<-ggplot(data,aes(x=ExpT1,y=T1_6H_R2 ))+geom_boxplot()
plot5<-ggplot(data,aes(x=ExpT2,y=T2_6H_R2))+geom_boxplot()
plot6<-ggplot(data,aes(x=ExpT3,y=T3_6H_R2 ))+geom_boxplot()

grid.arrange(plot1,plot2,plot3,plot4,plot5,plot6,ncol=6)
```
Tout d'abord, on remarque que les graphiques correspondant à la même variable qualitative se ressemblent fortement deux à deux, ce qui indique que les résultats d'expression des gènes à 6 heures des deux réplicats sont sensiblement les mêmes.
On observe égalament qu'au sein d'un même graphe, les boxplots parallèles sont très différents, ce qui indique que les variables quantitatives sont très liées aux variables qualitatives correspondantes, ce qui est cohérent avec les associations de variables choisies.

On peut également analyser les boxplots selon les différentes modalités des variables qualitatives :

Pour la modalité "non", les valeurs des boxplots (médiane et dispersion) se regroupent généralement autour de zéro ou restent proches de l’absence de variation (exception pour T1_6H_R2 pour lequel la médiane est plus basse et la varaince plus large). Cela indique une faible différence d’expression pour les gènes non-exprimés.

Pour la modalité "sous", les valeurs des boxplots sont toujours négatives, ce qui est attendu puisque ces gènes sont sous-exprimés par définition. Au contraire, pour la modalité "sur", les valeurs des boxplots sont toujours positives, avec des médianes plus élevées et une dispersion qui reflète une surexpression des gènes.

\newpage
# Analyse des Tt_sH_Rr

Nous souhaitons maintenant analyser les variables quantitatives Tt_sH_Rr en tant qu'individus.

## Analyse en composantes principales

Nous menons tout d'abord une analyse en composantes principales où les variables Tt_sH_Rr sont les individus décrits par les
gènes.

Au vu du nombre de variables très élevé pour cette partie (les 542 gènes), nous ne pouvons pas constater des dispersions et des échelles différentes entre les variables. Nous avons donc décidé d'appliquer une analyse en composantes principales sur les données centrées et réduites afin de donner un poids équivalent à chacune des variables et éviter ainsi que les variables à grande variance ne dominent l'analyse.

```{r,echo=FALSE, eval=T, results='hide'}
#ACP, création du tableau de données
dataACPv<-t(data[c(1:36)]) #on retire les variables qualitatives et on transpose le dataframe 
dim(dataACPv) #on vérifie les bonnes dimensions du jeu de données

#ACP centrée
#resacpa<-PCA((dataACPv),scale.unit = F,graph=F)
#resacpa$eig[1:3,]
```

```{r, echo=FALSE, eval=TRUE, fig.cap="\\label{fig:ACP1}Evolution de l'inertie portée par les axes factoriels"}
#ACP centrée réduite
respcav<-PCA((dataACPv),scale.unit = T,graph=F)
#respcav$eig[1:3,]
fviz_eig(respcav)
```
D'après les résultats de l'analyse en composantes principales en Figure \ref{fig:ACP1}, les deux premières composantes principales (Dim1 et Dim2) capturent 71,1 % et 10,5 % de l'inertie, soit un total cumulé de 81,6%. Cela signifie que l’essentiel de l’information contenue dans les données peut être visualisé dans un espace bidimensionnel, en ne conservant que les deux premiers plans factoriels.

Nous affichons la projection des individus sur les plans factoriels ainsi que le cercle des corrélations en Figure \ref{fig:figuresACP} afin d'identifier les individus et les variables importants.

```{r,eval=T, echo=FALSE, fig.cap="\\label{fig:figuresACP}Graphe des individus (gauche) et graphe des variables (droite)"}
#graphe des individus
g1<-fviz_pca_ind(respcav,geom=c("point"))

#graphe des variables
g2<-fviz_pca_var(respcav,geom=c("point"))
grid.arrange(g1,g2,ncol=2)
```
On identifie deux à trois groupes distincts dans l'espace des individus, ce qui souligne des différences claires dans les comportements d'expression des gènes sous les trois traitements différents. En revanche, le graphe des variables est difficilement interprétable en raison sa densité. On ne peut pas tirer de conclusions claires sur la contribution des variables ou sur les regroupements possibles entre elles.

Pour évaluer l'impact des traitements, on habille le graphe des variables par les résultats de décision (variables ExpT1, ExpT2 et ExpT3) en Figure \ref{fig:graph_var_hab}. {\textbf{\textsf{R}}}

```{r, echo=FALSE, eval=FALSE, fig.cap="\\label{fig:contributions}Contribution relative des individus à l'inertie sur les axes factoriels"}
#Contribution relative des individus à l'inertie sur les axes factoriels
cont1<-fviz_contrib(respcav, choice = "ind", axes = 1)
cont2<-fviz_contrib(respcav, choice = "ind", axes = 2)
grid.arrange(cont1,cont2,nrow=2)
```

```{r, echo=FALSE, eval=TRUE, fig.cap="\\label{fig:graph_var_hab}Graphe des variables expliqué en fonction des modalités des variables qualitatives"}

g1<-fviz_pca_var(respcav,geom=c("point"),habillage = as.factor(data$ExpT1))+ggtitle("ExpT1")
g2<-fviz_pca_var(respcav,geom=c("point"),habillage = as.factor(data$ExpT2))+ggtitle("ExpT2")
g3<-fviz_pca_var(respcav,geom=c("point"),habillage = as.factor(data$ExpT3))+ggtitle("ExpT3")

grid.arrange(g1,g2,g3,ncol=3)
```
D'après la Figure \ref{fig:graph_var_hab}, pour la variable ExpT1, les gènes qui prennent la modalitité "sous" se situent principalement dans la partie supérieure gauche du graphe, indiquant une contribution positive et significative à Dim2.
Les gènes "sur" apparaissent en bas, ce qui reflète une contribution négative à Dim2.
Ainsi lorsqu'on constate des effets sur l'experience ExpT1, ils se manifestent le long de la deuxième composante principale (Dim2).

En ce qui concerne les variables ExpT2 et ExpT3, les gènes prennant la modalité "sous" sont situées principalement à gauche du graphe, on a donc contribution négative à Dim1.
Les variables "sur" se trouvent à droite, on a, au contraire une contribution positive à Dim1.
La première composante principale (Dim1), qui explique 71,1 % de la variance, est fortement influencée par les expériences ExpT2 et ExpT3. Cette dimension distingue clairement les gènes sous-exprimés ("sous") et surexprimés ("sur") sous l’effet de ce traitement.

Pour expliquer ces changements, on effectue une analyse qui compare chacune des caractéristiques (replicat, traitement, heures) des trois experiences, retranscrite dans la Figure \ref{fig:graph_ind_hab}.

```{r, echo=FALSE, eval=F}
#Version test à enlever ?

#Habillage sur le graphe des individus - Réplicats
colors <- rep("red", nrow(dataACPv))
colors[1:18] <- "blue"
g1<-fviz_pca_ind(respcav, mean.point=FALSE, geom = "point", col.ind = colors) +
  scale_color_manual(values = c("blue" = "blue", "red" = "red"), 
                     labels = c("R1", "R2")) +
  labs(color = "Réplicats")

#Habillage sur le graphe des individus - Traitements
colors <- rep("red", nrow(dataACPv))
colors[c(1:6,19:25)] <- "blue"
colors[c(7:12,26:32)] <- "green"
g2<-fviz_pca_ind(respcav, mean.point=FALSE, geom = "point", col.ind = colors) +
  scale_color_manual(values = c("blue" = "blue", "green" = "green", "red" = "red"), 
                     labels = c("T1", "T2", "T3")) +
  labs(color = "Traitements")

#Habillage sur le graphe des individus - Heures
colors <- rep("red", nrow(dataACPv))
colors[c(1,7,13,19,25,31)] <- "blue"    # Heure 1
colors[c(2,8,14,20,26,32)] <- "green"   # Heure 2
colors[c(3,9,15,21,27,33)] <- "purple"  # Heure 3
colors[c(4,10,16,22,28,34)] <- "yellow" # Heure 4
colors[c(5,11,17,23,29,35)] <- "orange" # Heure 5

g3<-fviz_pca_ind(respcav, mean.point=FALSE, geom = "point", col.ind = colors) +
  scale_color_manual(values = c("blue" = "blue", "green" = "green", "purple" = "purple", 
                                "yellow" = "yellow", "orange" = "orange", "red" = "red"),
                     labels = c("Heure 1", "Heure 2", "Heure 3", "Heure 4", "Heure 5", "Heure 6")) +
  labs(color = "Heures") #Mean point sont les points donnant les moyennes

grid.arrange(g1,g2,g3,ncol=3)
```

```{r, echo=FALSE, eval=TRUE, fig.cap="\\label{fig:graph_ind_hab}Habillage du graphe des individus par réplicats, traitements et heures"}
Aux <- rownames(respcav$ind$coord)
#On choisit de ne pas afficher les individus de référence, malgré leurs apports d'information, pour garder le même graphe des individus que l'ACP

#Habillage sur le graphe des individus - Réplicats
replicats <- str_sub(Aux, 7, 8)
g1 <- fviz_pca_ind(respcav, habillage = as.factor(replicats), label = "none", mean.point=FALSE)+ggtitle("Réplicats")

#Habillage sur le graphe des individus - Traitements
traitements <- str_sub(Aux, 1, 2)
g2 <- fviz_pca_ind(respcav, habillage = as.factor(traitements), label = "none", mean.point=FALSE)+ggtitle("Traitements")

#Habillage sur le graphe des individus - Heures
heures <- str_sub(Aux, 4, 5)
g3 <- fviz_pca_ind(respcav, habillage = as.factor(heures), label = "none", mean.point=FALSE)+ggtitle("Heures")

grid.arrange(g1,g2,g3,ncol=3)
```
On observe que les individus issus des réplicats R1 et R2 sont distribués de manière équilibrée le long des deux dimensions, ainsi la variabilité n'est pas entièrement due à l'appartenance aux différents réplicats. 
On peut en conclure que les facteurs des traitements et des heures contribuent de manière plus significative à la structure des données.

Par ailleurs, les observations associées au traitement T1 se situent principalement sur la partie gauche du graphique, tandis que celles des traitements T2 et T3 sont davantage mélangées de façon homogène à droite.
Cela reflète une différenciation claire entre les effets du traitement T1 et ceux des traitements T2 et T3, ce qui appuie l'observation déjà faite lors de l'analyse bi-dimensionnelle.

Enfin, à l'issue de la première heure, toutes les observations, quel que soit le traitement, se regroupent sur la gauche du graphique. On a donc une faible contribution de Dim1, accompagnée d’une dynamique plus hétérogène sur Dim2.
Dès la deuxième heure, une séparation claire apparaît : la contribution par rapport à Dim1 devient opposée entre le traitement T1 et les deux autres traitements.
Après cette séparation, la variabilité entre les heures oscille principalement autour de la contribution de Dim2, reflétant une évolution distincte dans les réponses des gènes au fil du temps.

## Clustering

Nous souhaitons maintenant faire une classification non supervisée des données afin de regrouper les Tt_sH_Rr en plusieurs calsses homogènes.

### Détermination du nombre de classes nécessaires

Tout d'abord, nous déterminons le nombre de classes nécéssaires au clustering à l'aide de deux critères distincts : l'étude de l'évolution de l'inertie intra-classe et l'étude de silhouette, pour lesquels nous affichons les résultats en Figure \ref{fig:nb_classes1}.

```{r, echo=FALSE, eval=TRUE, results='hide'}
#Inertie intraclasse

set.seed(2)
Kmax<-15
reskmeanscl<-matrix(0,nrow=nrow(dataACPv),ncol=Kmax-1)
Iintra<-NULL
for (k in 2:Kmax){
  resaux<-kmeans(dataACPv,k)
  reskmeanscl[,k-1]<-resaux$cluster
  Iintra<-c(Iintra,resaux$tot.withinss)
}

df<-data.frame(K=2:15,Iintra=Iintra)
g1<-ggplot(df,aes(x=K,y=Iintra))+
  geom_line()+
  geom_point()+
  xlab("Nombre de classes")+
  ylab("Inertie intraclasse") 
  #ggtitle("Figure 9.1: Inertie intraclasse")
```

```{r, echo=FALSE, eval=TRUE, fig.cap="\\label{fig:nb_classes1}Evolution de l'inertie intra-classe et silhouette", results='hide'}
#silhouette

Silhou<-NULL
for (k in 2:Kmax){
   aux<-silhouette(reskmeanscl[,k-1], daisy(dataACPv))
   Silhou<-c(Silhou,mean(aux[,3]))
}

df<-data.frame(K=2:Kmax,Silhouette=Silhou)
g2<-ggplot(df,aes(x=K,y=Silhouette))+
  geom_point()+
  geom_line()+theme(legend.position = "bottom")
# ggtitle("Figure 10 : Coefficients silhouette")

aux<-silhouette(reskmeanscl[,2],daisy(dataACPv))
g3<-fviz_silhouette(aux)+
  theme(plot.title = element_text(size =9)) 
#+ ggtitle("Figure 11 : Visualisation des silhouettes")
rm(df,Silhou,aux)

g1 <- g1 + ggtitle("Figure 9.1: Inertie intraclasse") + theme(plot.title = element_text(hjust = 0.5, vjust = 2))
g2 <- g2 + ggtitle("Figure 9.2: Coefficients silhouettes") + theme(plot.title = element_text(hjust = 0.5, vjust = 2))
g3 <- g3 + ggtitle("Figure 9.3 : Visualisation des silhouettes") + theme(plot.title = element_text(hjust = 0.5, vjust = 2))

grid.arrange(g1,g2,g3,ncol=3)
```
En observant le graphique de l'inertie intra-classe, le "coude" apparaît au bout de trois classes. On décide donc d'en créer trois, ce qui devrait permettre de capturer une quantité significative de variance.

Le graphe de silhouette connait sa chute significative au bout de 3 classes. Ainsi les deux graphiques convergent vers l'hypothèse de créer 3 classes différentes dans notre clusering.

### Méthode des Kmeans

On applique dans un premier temps la méthode des Kmeans qui permet d'obtenir les trois clusters : {\textbf{\textsf{R}}} 
Figure \ref{fig:kmeans1}

Grace à la commande reskmeans$cluster on visualise les appartenances aux différents clusters
```{r,echo=F,eval=T,results='hide'}
set.seed(25)
reskmeans<-kmeans(dataACPv,3) 
```

```{r, ehco=F, eval=T, fig.cap="\\label{fig:kmeans1}Graphe des individus avec représentation des clusters après K-Means"}
fviz_cluster(reskmeans,data=dataACPv,
             ellipse.type="norm",labelsize=8,
             geom=c("point"))+ggtitle("")

```

```{r,eval=T}
#Visualisation des variables et de leur cluster d'appartenance
reskmeans$cluster
```

Cluster 1 : Réponse homogène aux traitements T2 et T3
Ce cluster regroupe principalement les observations des traitements T2 et T3, en particulier pour les heures de ces derniers. On peut en déduire que les premiers effets de ces présentent une faible variabilité.

Cluster 2 : Transition ou réponse intermédiaire
Les observations associées à ce cluster une couverture plus large, incluant des variations d’expression génétique pour T2 et T3 aux heures 3 à 6. Elles reflètent des changements plus dynamiques des gènes dans le temps, potentiellement liés aux différentes réponses des gènes face aux traitements.
Les réplicats de ce cluster montrent des similarités notables entre les traitements T2 et T3, renforçant l’idée que ces deux traitements agissent de manière similaire sur les gènes, mais peut être à des moments différents.

Cluster 3 : Réponse spécifique aux premières heures de T1
Les observations du cluster 3 sont principalement liées au traitement T1. Cela indique que T1 induit une réponse différente par rapport à T2 et T3, caractérisée par des variations génétiques plus faibles. T1 ne déclenche pas les mêmes mécanismes biologiques et exprime beaucoup moins de changement génétique.


### Classification hiérarchique

Nous souhaitons maintenant mettre en place un classification hiérarchique des Tt_sH_Rr.

```{r, echo=F, eval=T}
# dendogramme
dist_dataACPv = dist(dataACPv)

hward<-hclust(dist_dataACPv, method = "ward.D2") 
#fviz_dend(hward,show_labels=FALSE)
```

```{r ,fig.cap="\\label{fig:CAH1}Dendrogramme et répartition des clusters de la classification hiérarchique"}
# A COMPLETER
CH<-NULL
Kmax<-20
for (k in 2:Kmax){
  CH<-c(CH,index.G1(dataACPv, cl= cutree(hward,k)))
}
#On prend k = 3
daux<-data.frame(NbClust=2:Kmax,CH=CH)
g1<-ggplot(daux,aes(x=NbClust,y=CH))+
  geom_line()+
  geom_point()

ClustCH<-cutree(hward,k=3)
g2<-fviz_dend(hward, show_labels = FALSE, k = 3)
g3<-fviz_pca_ind(respcav, geom = c("point"), habillage = as.factor(ClustCH)) 

grid.arrange(g1,g2,g3,ncol=3)
```
Le choix du nombre de cluster n'est pas évident en voyant le pic du critère de Calinski-Harabasz. L'hyopthèse de trois clusters faite lors des Kmeans n'est donc pas incohérente et peut être gardée pour la classification hierarchique.

Sur le dendrogramme, l’axe vertical représente la distance/différences entre les observations, ici les gènes selon leur d'expression sous différents traitements.
Les gènes exposés au traitement T1 forment un groupe distinct (cluster rouge). Ce cluster se regroupe avec les autres seulement à une grande hauteur (environ 200), ce qui indique qu’il est très différent des groupes correspondant aux traitements T2 et T3.
Les gènes des traitements T2 et T3 se regroupent à des hauteurs plus faibles (inférieures à 100), indiquant une plus grande similarité dans leurs réponses aux traitements. Cela reflète que T2 et T3 induisent des expressions génétiques similaires.

Sur le graphiques des individus, les clusters projetés sur le premier plan factoriel montrent une bonne séparation dans les deux premières composantes principales (Dim1 et Dim2). On a bien des différences significatives entre les groupes. On observe que les gènes classés dans un même cluster partagent des comportements similaires en termes d'expression génétique sous l'effet de différents traitements. 

# Analyse des gènes

Nous nous intéressons enfin à l'analyse des gènes du jeu de données en tant qu'individus.

## Analyse en composantes principales

Pour commencer, nous menons une analyse en composantes principales du jeu de données "DataExpMoy" contenant la moyenne des expressions sur les réplicats de chaque gène, pour chaque traitement et chaque heure. Nous avons donc un jeu de données composé de 542 individus et caractérisé par 18 variables quantitatives, auquel on ajoute les variables qualitatives. {\textbf{\textsf{R}}}

```{r, echo=FALSE, eval=TRUE, results='hide'}
#Création du jeu de données DataExpMoy
dataR1<-data[,1:18]
dataR2<-data[,19:36]
dataACPg<-(dataR1+dataR2)/2
dim(dataACPg) #on a bien Gx18

#On ajoute les variables qualitatives
dataACPg<-cbind(dataACPg, ExpT1=data$ExpT1, ExpT2=data$ExpT2, ExpT3=data$ExpT3)
dim(dataACPg)
```

Les variables sont ici les moyennes deux à deux des variables correspondant à un même traitement, à la même heure pour les deux réplicats (par exemple T1_1H_R1 et T1_1H_R2 donnent la variable nommée T1_1H_R1 dans le nouveau jeu de données). D'après la Figure \ref{fig:boxplots_quantitatives1} et la Figure \ref{fig:boxplots_quantitatives2} de l'analyse uni-dimensionnelle, les deux réplicats présentent de grandes similitudes dans les résultats. Toutefois, les boxplots des variables du traitement T1 montrent des dispersions très différentes des boxplots des variables des traitements T2 et T3.
Comme les échelles des variables diffèrent, on décide d'appliquer une analyse en composantes principales sur les données centrées et réduites afin d'éviter que les variables à grande variance ne dominent l'analyse.

```{r,echo=FALSE, eval=T, results='hide', fig.cap="\\label{fig:ACP2}Evolution de l'inertie portée par les axes factoriels"}
#ACP Centrée réduite
respcag<-PCA(dataACPg,quali.sup=c(19,20,21),scale.unit = TRUE,graph=F)
respcag$eig[1:5,]
fviz_eig(respcag)

```
Les deux premières composantes principales (Dim1 et Dim2) capturent 59,2 % et 22,2 % de la variance totale, soit un total cumulé de 81,4%. Cela signifie que l’essentiel de l’information contenue dans les données peut être visualisé dans un espace bidimensionnel.

Nous affichons la projection des individus sur les plans factoriels ainsi que le cercle des corrélations des variables initiales avec les méta-variables en Figure \ref{fig:figuresACP2} afin d’identifier les individus et les variables importants. Nous complétons avec la matrice des corrélations en Figure \ref{fig:corrACP2}.

\newpage

```{r, echo=FALSE, eval=TRUE, fig.cap="\\label{fig:figuresACP2}Graphe des variables (gauche) et graphe des individus (droite)"}
Aux<-rownames(respcag$var$coord)
#Aux
Traitements<-str_sub(Aux,1,2)
#Traitements

g1<-fviz_pca_var(respcag,habillage=as.factor(Traitements)) #graphique des corrélations entre les variables initiales et les méta-variables => Illisible

g2<-fviz_pca_ind(respcag,col.ind="contrib",geom=c("point"))
grid.arrange(g1,g2,ncol=2)
```
```{r, echo=FALSE, eval=TRUE, fig.cap="\\label{fig:corrACP2}Matrice des corrélations des variables initiales avec les méta-variables"}
corrplot(t(respcag$var$cor),method="ellipse")  #les corrélations des variables initiales avec toutes les méta-variables => Plus lisible
```
D'après la Figure \ref{fig:figuresACP2} (graphe des variables) et la Figure \ref{fig:corrACP2}, la première composante principale (métavariable Dim1) est portée en majorité par T2 et T3 qui sont fortement corrélées.
La seconde composante principale (métavariable Dim2) est davantage portée par T1. On remarque que plus les heures avance, plus le traitement 1 se rapproche de l'axe de dim2. En revanche, T2 et T3 influencent la seconde composante principale de façon majoritairement négative bien que la corrélation soit faible.
On note que la projection sur le premier plan factoriel de l’expérience T3_1h_R1 est influencé par les deux composantes principales.

D'après le graphe des individus en Figure \ref{fig:figuresACP2}, la majorité des points sont éloignés de l’origine, ce qui indique que la plupart des gènes présentent des variations marquées dans leurs niveaux d’expression. À l’inverse, les points proches de l’origine montrent des variations faibles, ce qui pourrait correspondre aux gènes influencés par le traitement T1. Les gènes qui contribuent fortement à la composante principale Dim1 montrent une contribution relativement uniforme à Dim2, mais de faible intensité. En revanche, pour les gènes ayant une faible contribution à Dim1, on observe une répartition plus marquée de leurs contributions le long de Dim2.

## Clustering

On décide de faire un clustering sur les données brutes car, quelque soit le gène considéré, on étudie les mêmes composantes. Le fait de centrer et réduire les données nous ferait perdre de l'information.

### Détermination du nombre de classes nécessaires

```{r, echo=FALSE, eval=TRUE, results='hide'}
set.seed(25)
dataACPgC <- dataACPg[,-c(19,20,21)]

Kmax<-15
reskmeanscl<-matrix(0,nrow=nrow(dataACPg),ncol=Kmax-1)
Iintra<-NULL
for (k in 2:Kmax){
  resaux<-kmeans(dataACPgC,k)
  reskmeanscl[,k-1]<-resaux$cluster
  Iintra<-c(Iintra,resaux$tot.withinss)
}

df<-data.frame(K=2:15,Iintra=Iintra)
g1<-ggplot(df,aes(x=K,y=Iintra))+
  geom_line()+
  geom_point()+
  xlab("Nombre de classes")+
  ylab("Inertie intraclasse")

```

```{r, echo=FALSE, eval=TRUE, fig.cap="\\label{fig:nb_classes2}Evolution de l'inertie intra-classe et silhouette", results='hide'}
# Silhouette 

Silhou<-NULL
for (k in 2:Kmax){
   aux<-silhouette(reskmeanscl[,k-1], daisy(dataACPgC))
   Silhou<-c(Silhou,mean(aux[,3]))
}

df<-data.frame(K=2:Kmax,Silhouette=Silhou)
g2<-ggplot(df,aes(x=K,y=Silhouette))+
  geom_point()+
  geom_line()+theme(legend.position = "bottom")

aux<-silhouette(reskmeanscl[,2],daisy(dataACPgC))
g3<-fviz_silhouette(aux)+
  theme(plot.title = element_text(size =9))
rm(df,Silhou,aux)

aux<-silhouette(reskmeanscl[,3],daisy(dataACPgC))
g4<-fviz_silhouette(aux)+
  theme(plot.title = element_text(size =9))
rm(df,Silhou,aux)


grid.arrange(g1,g2,g3,g4,ncol=4)
```
En observant le graphique de l'inertie intra-classe sur la Figure \ref{fig:nb_classes2}, le "coude" apparaît autour de quatre classes. On décide donc d'en créer quatre, ce qui devrait permettre de capturer une quantité significative de variance.

On observe de "chute" sur le graphique de silhouette au point trois et cinq. On prend le coefficient de silhouette moyen de quatre classes qui est légèrement plus élevé que pour d'autres choix de nombre de clusters.

### Méthode des Kmeans

On applique la méthode des Kmeans qui permet d'obtenir les quatre clusters : {\textbf{\textsf{R}}} 
```{r, echo=F, eval=T}
set.seed(1)
reskmeans<-kmeans(dataACPgC,4) 
```

```{r, echo=F, eval=T, fig.cap="\\label{fig:Kmeans2}Graphe des individus avec représentation des clusters après K-Means"}
fviz_cluster(reskmeans,data=dataACPgC,
             ellipse.type="norm",labelsize=8,
             geom=c("point"))+ggtitle("")
```

```{r, echo=F, eval=T, results='hide'}
#fviz_pca_ind(respcag,col.ind=as.factor(reskmeans$cluster), geom = c("point"),axes=c(1,2))
reskmeans$cluster
```

Cluster 1 : Gènes faiblement influencés par les traitements
Ce cluster regroupe des gènes dont les variations d’expression sont faibles, quel que soit le traitement ou l’heure d’observation. On les retrouve prêt de l’origine du repère. 
Ces gènes pourraient correspondre au traitement 1, qui ne déclenche majoritairement pas de changement majeur.
Ils peuvent cependant servir de référence pour analyser les gènes plus « dynamiques » aux traitements 2 et 3.

Cluster 2 : Gènes avec une dynamique intermédiaire dans les variations d’expression
Ce cluster regroupe des gènes présentant des réponses modérées aux traitements. Les variations d’expression observées dans ce groupe ne sont ni faibles ni fortement marquées.
Ces gènes pourraient refléter l'etape intermédiaire de la progression.
Ainsi on peut voir les transitions entre des gènes peu réactifs et ceux fortement influencés, particulièrement sous l’effet des traitements T2 et T3.

Cluster 3 : Gènes avec des réactions génétiques marquées aux traitements avancés
Ce cluster se distingue par des variations génétiques importantes, associées principalement aux heures avancées des traitements T2 et T3. 
L'évolution de ces gènes sont déclenchés dans la durée par les traitements T2 et T3.

Cluster 4 :Gènes fortement influencés par les traitements T2 et T3 aux premières heures
Ce cluster regroupe des gènes dont les variations d’expression sont rapides et marquées, observées principalement dans les premières heures des traitements T2 et T3.
Ces gènes traduisent une réponse précoce aux traitements.

### Classification hiérarchique

Puisqu'on analyse un même nombre de gènes entre chaque experiece, on  utilise Ward comme mesure d'agrégation. Au vu de l'analyse avec les K-means, on cherche à former des classes sphériques avec des effectifs équivalents. 

```{r, echo=FALSE, eval=TRUE, fig.cap="\\label{fig:dendrogramme}Dendrogramme des gènes"}
# dendrogramme
dist_dataACPg = dist(dataACPgC)

hward<-hclust(dist_dataACPg, method = "ward.D2") 
fviz_dend(hward,show_labels=FALSE)
```

Au vu du nombre important de gènes considérés ici, on ne peut pas faire une conjecture du nombre de clusters grâce à la lecture du dendrogramme.

```{r, echo=FALSE, eval=TRUE, fig.cap="\\label{fig:Dendrogramme et répartition des clusters de la classification hiérarchique}à completer"}
CH<-NULL
Kmax<-20
for (k in 2:Kmax){
  CH<-c(CH,index.G1(dataACPgC, cl= cutree(hward,k)))
}
#On prend k = 3
daux<-data.frame(NbClust=2:Kmax,CH=CH)
g1<-ggplot(daux,aes(x=NbClust,y=CH))+
  geom_line()+
  geom_point()

ClustCH<-cutree(hward,k=4)
g2<-fviz_dend(hward, show_labels = FALSE, k = 4)
g3<-fviz_pca_ind(respcag, geom = c("point"), habillage = as.factor(ClustCH)) 

grid.arrange(g1,g2,g3,ncol=3)
```

Sur le  graphe du critère de Calinski-Harabasz, on observe une forte diminution du critère CH au début (entre un et cinq clusters), suivie d'une diminution plus progressive pour un nombre de clusters supérieur.
Le point de "coude" semble être autour de quatre clusters, où la pente change notablement avant de devenir plus linéaire.
Sur la base de ce graphique et des Kmeans fait précédemment, quatre clusters ont choisis pour la classification hiérarchique. Ils maximisent le critère CH tout en évitant une complexité inutile liée à un trop grand nombre de clusters.

La hauteur où le dendrogramme présente quatre grandes branches, les gènes sont donc classés en quatre clusters.
Ces derniers sont interprétés à l'aide du graphe des individus:

Cluster 1 : Gènes faiblement influencés par les traitements (variations faibles, proches de l'origine du repère). Ils pourraient être associés principalement au traitement T1.
Cluster 2 : Gènes avec une réponse modérée aux traitements.
Cluster 3 : Gènes fortement influencés par les traitements aux heures avancées, principalement T2 et T3. Ces gènes montrent de grandes variations après plusieurs heures de traitement.
Cluster 4 : Gènes avec des variations marquées tôt dans le traitement, surtout pour T2 et T3, montrant une réponse rapide aux traitements.

```{r, echo=FALSE, eval=TRUE, fig.cap="\\label{fig:a completer}Diagramme d'alluvions des correspondances entre les clusters des K-means et de la classification hiérarchique", results='hide'}
clust1<-paste("Cl-K",reskmeans$cluster,sep="")
clust2<-paste("Cl-hiérarchique",ClustCH,sep="")
Tab<-melt(table(clust1,clust2))
ggplot(Tab,aes(y=value,axis1=clust1,axis2=clust2))+
  geom_alluvium(aes(fill=clust1))+
  geom_stratum(width = 1/12)+   
  geom_text(stat = "stratum", aes(label = after_stat(stratum)))+
  theme(legend.position = "none")
```

Les deux méthodes (Kmeans et classification hiérarchique) ont identifié quatre clusters optimaux.
On observe que le quatrième clusters des Kmeans présente des gènes qui sont plus éparpillés dans la classification hiérarchique. On en conclut que la classification hiérarchique donne un résultat légèrement plus précis sur la classification des gènes? Excepté cela, on remarque que les clusters sont presque identiques, quelque soit la méthode utilisée.

### Comparaison des différentes méthodes d'ACP et de clustering des différentes experiences

```{r, echo=FALSE, eval=TRUE, fig.cap="\\label{fig: completer}Habillage du graphe des individus par expression des gènes sur chaque experience"}
g1<-fviz_pca_ind(respcag,habillage="ExpT1",geom=c("point"))
g2<-fviz_pca_ind(respcag,habillage="ExpT2",geom=c("point"))
g3<-fviz_pca_ind(respcag,habillage="ExpT3",geom=c("point"))
grid.arrange(g1,g2,g3,ncol=3)

```

Les graphiques des individus révèlent des différences marquées entre les traitements T1, T2, et T3 en termes de réponse génétique. D’après la Figure (ExpT1), la majorité des gènes sous le traitement T1 restent dans la modalité "Non", indiquant une absence d'évolution significative de leur expression. Les groupes "Sous" et "Sur" sont peu représentés, soulignant l’effet limité de T1 sur l'expression génétique. 
En revanche, la Figure (ExpT2) montre une répartition plus large des gènes dans les modalités "Sous" et "Sur", ce qui traduit une réponse génétique plus forte au traitement T2, avec un nombre significativement réduit de gènes dans la modalité "Non" par rapport à T1.
Enfin, la Figure (ExpT3) présente une distribution similaire à celle de T2, mais avec une augmentation notable du groupe "Sur" exprimé. Cela confirme que le traitement T3, issu d'une combinaison des traitements T1 et T2, amplifie les effets de T2 tout en masquant en grande partie l’impact limité de T1.

On retrouve les mêmes conclusions que la première ACP faite précédemment.

```{r}
clust<-paste("Cl-K",reskmeans$cluster,sep="")
Tab<-melt(table(clust,dataACPg[,19]))
g1<-ggplot(Tab,aes(y=value,axis1=clust,axis2=Var2))+
  geom_alluvium(aes(fill=clust))+
  geom_stratum(width = 1/12)+   
  geom_text(stat = "stratum", aes(label = after_stat(stratum)))+
  ggtitle("EXPT1")+
  theme(legend.position = "none")
```


```{r, echo=FALSE, eval=TRUE, results='hide'}
clust<-paste("Cl-K",reskmeans$cluster,sep="")
Tab<-melt(table(clust,dataACPg[,20]))
g2<-ggplot(Tab,aes(y=value,axis1=clust,axis2=Var2))+
  geom_alluvium(aes(fill=clust))+
  geom_stratum(width = 1/12)+   
  geom_text(stat = "stratum", aes(label = after_stat(stratum)))+
  ggtitle("EXPT2")
  theme(legend.position = "none")

```

```{r, echo=FALSE, eval=TRUE, fig.cap="\\label{fig:completer}Diagramme d'alluvions des expressions génétiques dans les clusters du K-means", results='hide', fig.height=2.5}
clust<-paste("Cl-K",reskmeans$cluster,sep="")
Tab<-melt(table(clust,dataACPg[,21]))
g3<-ggplot(Tab,aes(y=value,axis1=clust,axis2=Var2))+
  geom_alluvium(aes(fill=clust))+
  geom_stratum(width = 1/12)+   
  geom_text(stat = "stratum", aes(label = after_stat(stratum)))+
  ggtitle("EXPT3")
  theme(legend.position = "none")
grid.arrange(g1, g2, g3, ncol=3)

```

```{r}
clust<-paste("Cl-hiérarchique",ClustCH,sep="")
Tab<-melt(table(clust,dataACPg[,19]))
g1<-ggplot(Tab,aes(y=value,axis1=clust,axis2=Var2))+
  geom_alluvium(aes(fill=clust))+
  geom_stratum(width = 1/12)+   
  geom_text(stat = "stratum", aes(label = after_stat(stratum)))+
  ggtitle("EXPT1")+
  theme(legend.position = "none")
```

```{r, echo=FALSE, eval=TRUE, results='hide'}
clust<-paste("Cl-hiérarchique",ClustCH,sep="")
Tab<-melt(table(clust,dataACPg[,20]))
g2<-ggplot(Tab,aes(y=value,axis1=clust,axis2=Var2))+
  geom_alluvium(aes(fill=clust))+
  geom_stratum(width = 1/12)+   
  geom_text(stat = "stratum", aes(label = after_stat(stratum)))+
  ggtitle("EXPT2")
  theme(legend.position = "none")

```

```{r, echo=FALSE, eval=TRUE, fig.cap="\\label{fig:completer}Diagramme d'alluvions des expressions génétiques dans les clusters de la classification hiérarchique", results='hide', fig.height=2.5}
clust<-paste("Cl-hiérarchique",ClustCH,sep="")
Tab<-melt(table(clust,dataACPg[,21]))
g3<-ggplot(Tab,aes(y=value,axis1=clust,axis2=Var2))+
  geom_alluvium(aes(fill=clust))+
  geom_stratum(width = 1/12)+   
  geom_text(stat = "stratum", aes(label = after_stat(stratum)))+
  ggtitle("EXPT3")
  theme(legend.position = "none")
grid.arrange(g1,g2,g3,ncol=3)

```



Les résultats des clustering suite aux Kmeans (Figure 23) et de la classification hiérarchique (Figure 24) permettent d'en arriver aux mêmes conclusions: Les gènes répondent de manière distincte aux traitements. EXPT1 génère une faible réponse, avec des gènes sans réaction notables dans tous les clusters et en grand nombre. EXPT2 et EXPT3 induisent des réponses plus variées, avec une minorité quasimet négligeable de gène "Non".

# Conclusion

Les analyses descriptives ont montré des disparités marquées entre les traitements. T1 s’est révélé peu efficace, avec une majorité de gènes ne présentant pas de variation notable d’expression. En revanche, T2 a induit des changements significatifs, avec une répartition équilibrée entre les gènes surexprimés et sous-exprimés. Le traitement T3, conçu comme une combinaison des effets de T1 et T2, s’est distingué par ses effets légèrement amplifié par rapport au second traitement. On retrouve des résultats similaires à ceux observées avec T2 tout en masquant en grande partie l’effet limité de T1. Ainsi on peut en conclure que T2 constitue le facteur dominant dans la combinaison.

L’ACP a confirmé cette observation en identifiant deux composantes principales où les effets de T2 et T3 se regroupent, tandis que T1 se positionne à part, avec des réponses globalement faibles.

Le clustering a renforcé ces conclusions en identifiant des groupes de gènes différenciés par leurs réponses aux traitements, notamment par rapport au temps. Ces résultats ont mis en évidence des gènes réagissant rapidement (notamment aux premières heures de T2 et T3), ainsi que des gènes montrant des variations plus marquées sur une période prolongée.
