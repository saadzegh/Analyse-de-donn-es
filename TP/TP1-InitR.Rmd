---
title: "TP 1  : Initiation au langage R. D√©couverte de Rstudio et Rmarkdown"
date : "3MIC - 2024-2025"
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: true
---

```{css,echo=F}
.badCode {
background-color: #C9DDE4;
}
```

```{r setup, echo=FALSE, cache=FALSE}
library(knitr)
## Global options
opts_chunk$set(echo=TRUE,
	             cache=TRUE,
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=FALSE,
               class.source="badCode")
```

**Objectif** 

Les objectifs de cette s√©ance sont 

+ une premi√®re prise en main du logiciel R avec la pr√©sentation de commandes de base
+ se familiariser avec RStudio 
+ d√©buter dans la r√©daction de documents en Rmarkdown


# Introduction

## Pourquoi R ?

Le logiciel R sous licence GNU est facile √† installer √† partir de la page du [CRAN](https://cran.r-project.org/index.html){target="_blank"} (ou d'un site miroir). Le CRAN contient toutes les ressources n√©cessaires √† l'utilisateur de R, d√©butant ou exp√©riment√© : fichiers d'installation, mises √† jour, librairies, FAQ, newsletter, documentation... R est un logiciel tr√®s utilis√© dans la communaut√© statistique.

Dans sa structure, R est un langage de programmation d'une syntaxe voisine √† celle du langage C et capable de manipuler des objets complexes sous forme de matrice, scalaire, vecteur, liste, facteur et aussi data frame. Il dispose √©galement d'une tr√®s riche librairie de quasiment toutes les proc√©dures et m√©thodes statistiques de la litt√©rature. Plus pr√©cis√©ment, toutes les recherches r√©centes sont d'abord d√©velopp√©es et diffus√©es √† l'aide de ce
logiciel par la communaut√© scientifique.

## Pr√©sentation de Rstudio

Nous allons utiliser [RStudio](https://rstudio.com/){target="_blank"} durant les TP d'Analyse de Donn√©es. RStudio n‚Äôest pas qu‚Äôune interface graphique pour R, il s‚Äôagit d‚Äôun environnement de d√©veloppement int√©gr√©, proposant des outils et facilite l‚Äô√©criture de scripts et l‚Äôutilisation de R. La version gratuite de RStudio √©tant d√©j√† tr√®s riche en fonctionnalit√©s, elle est suffisante pour les enseignements. Elle est disponible pour Linux, Windows et MacOS. 

Sur les ordinateurs en salle TP, sous linux, 

- √† partir d'un terminal, placez vous dans le r√©pertoire de travail et tapez la commande `rstudio`
- par le menu d√©roulant, allez dans Applications/Programmation/RStudio

Si vous souhaitez travailler sur votre propre ordinateur, installez tout d'abord la derni√®re version du logiciel R (voir [CRAN](https://cran.r-project.org/index.html){target="_blank"}) puis installez la version gratuite de Rstudio adapt√©e √† votre OS. 

### Description des fen√™tres de RStudio

A chaque ouverture de RStudio, l'√©cran est d√©coup√© en quatre grandes zones :

- En bas √† gauche c'est la **Console**, on peut y lire au lancement la version de R que RStudio a charg√©. Apr√®s le texte d'entr√©e, la ligne commence par `>` qui est l'invite de commande. RStudio est pr√™t √† recevoir votre premi√®re commande. On peut se servir de R comme d'une calculatrice. Vous pouvez par exemple taper `> 2+3` et taper `Entr√©e`. Le r√©sultat apparait alors dans la console. 

- En haut √† droite, on peut voir dans **Environnement** la liste des objets et fonctions cr√©√©s au fur et √† mesure du travail. On a √©galement acc√®s √† l'historique des commandes dans **History**. 

- En bas √† droite, on trouve plusieurs onglets : 

  + **Files** : permet de voir le contenu du r√©pertoire de travail
  + **Plots** : permet de visualiser les graphiques cr√©√©s
  + **Packages** : liste les packages install√©s pour les charger, mettre √† jour, en installer d'autres 
  + **Help** : permet d'acc√©der √† l'aide en ligne
  
- En haut √† gauche, c'est la zone d'**Edition** pour g√©rer les scripts, les executer, ....  

Lorsque vous quittez RStudio, on vous demande si vous souhaiter sauvegarder l'environnement de travail. Si vous y r√©pondez favorablement, un fichier de sauvegarde ` .RData` est enregistr√© dans le r√©pertoire courant. 

### Types de documents avec RStudio 

En allant dans `File -> New File` ou en cliquant sur la fl√®che √† c√¥t√© de l'icone de *New File* (en haut √† gauche), RStudio propose de nombreux types de document. Vous pouvez noter que l'on peut utiliser RStudio √©galement pour faire du python, du C++, ... Nous allons ici ne parler que de quelques types de fichiers que l'on utilisera par la suite.

Pour cr√©er un script R, il suffit de s√©lectionner `R Script`. Ce script peut √™tre enregistr√© √† tout moment dans un fichier avec l'extension " .R" *(ex. monScript.R)* dans le r√©pertoire courant en cliquant sur l'ic√¥ne de disquette ou  par `File->Save`. Vous pouvez l'ouvrir √† tout moment gr√¢ce au menu `File ‚Äì> Open file...`, √† l'ic√¥ne dossier ou en double cliquant sur le fichier *monScript.R*. Il est √©galement possible d'executer un script directement depuis la console gr√¢ce √† la commande `source("monScript.R")`.

On peut √©galement cr√©er des documents de type rapport, slides, ... contenant du texte, du code, des images, des formules math√©matiques en latex, .... 

+ √† l'aide de `RMarkdown` en s√©lectionnant `R markdown ...`. Le document cr√©√© sera sauvegard√© avec l'extension " .Rmd". On reviendra plus pr√©cis√©ment sur les possibilit√©s offertes par Rmarkdown et les commandes principales pour d√©buter la r√©daction d'un rapport dans la section suivante. 

+ √† l'aide de `quarto` en s√©lectionnant `Quarto Document ...` ou `Quarto Presentation ...` pour la cr√©ation de pr√©sentation, rapports, ... Par exemple les slides du cours d'Analyse de Donn√©es ont √©t√© g√©n√©r√©s en quarto. La syntaxe est assez proche de celle de Rmarkdown. 

## Environnement

### R√©pertoire de travail

Pour pouvoir r√©cup√©rer des donn√©es, ma√Ætriser la sauvegarde des  scripts, des r√©sultats, ... il est important de connaitre le r√©pertoire de travail c'est-√†-dire le r√©pertoire sous lequel les divers r√©sultats seront sauvegard√©s par d√©faut. Ce dernier s'obtient √† l'aide de la commande `> getwd()`. 

Pour changer de r√©pertoire de travail, on peut 

- utiliser la commande `setwd()` dans la Console. 
A noter que R ne reconna√Æt que le caract√®re "/" pour sp√©cifier le chemin d'acc√®s d'un r√©pertoire (m√™me sous Windows). 
- passer par `Session -> Set Working Directory -> Choose Directory`. 

<h4><b><p style="color:blue;">Exercice :</p></b></h4>  

> Cr√©er un dossier de travail pour ce TP dans votre home (en dehors de RStudio!) 
> Dans RStudio, placez-vous dans ce dossier de travail pour le TP. 

### Les librairies pour R 

R est un logiciel libre, il s'enrichit gr√¢ce au d√©veloppement de librairies par la communaut√©. La plupart des extensions sont d√©velopp√©es et maintenues par la communaut√© des utilisateurs de R, et diffus√©es via le [CRAN (Comprehensive R Archive Network)](https://cran.r-project.org/){target="_blank"}. On peut √©galement trouver des packages d√©pos√©s sur *github* par exemple.

A la premi√®re ouverture de RStudio sur les ordinateurs de salle TP, un dossier `R/libs` est cr√©√© dans votre `home` pour l'installation des librairies. 

Pour installer une librairie disponible sur le CRAN, vous avez plusieurs mani√®res de le faire, dont  

+ passer par le menu `Tools-> Install Packages ...` , s√©lectionner un site miroir du CRAN et demander la librairie souhait√©e
+ aller dans l'onglet *Packages* dans la fen√™tre en bas √† droite et cliquer sur *Install*. 
+ utiliser la fonction `install.packages()` directement dans la console en pr√©cisant la librairie souhait√©e

Toutes les librairies ne sont pas charg√©es automatiquement au lancement de R. Pour charger une librairie, on utilise la commande `library()`. 

<h4><b><p style="color:blue;">Exercice :</p></b></h4>  

> 1. Installez la librairie *corrplot*
> 2. Chargez la librairie *corrplot*

### L'aide de R

On peut √† tout moment faire appel √† l'aide int√©gr√©e de R (et surtout avant d'appeler l'enseignant-e !) pour avoir les d√©tails comme les arguments d'une fonction.
On peut acc√©der √† l'aide pour une fonction (ex pour la fonction *plot*) en passant le nom de la fonction dans `help()` (ex `> help(plot)`) ou en utilisant le raccourci `> ?plot`. 
Ces deux commandes permettent d'afficher une page de description (en anglais) de la fonction, ses param√®tres, son r√©sultat, d'exemples, ... Dans RStudio, les pages d'aide en ligne s'ouvriront par d√©faut dans la zone en bas √† droite, sous l'onglet **Help**. Un clic sur l'ic√¥ne en forme de maison vous affichera la page d'accueil de l'aide. Vous pouvez aussi taper directement le nom de la fonction recherch√©e dans la zone de recherche dans l'onglet **Help**. 

<h4><b><p style="color:blue;">Exercice :</p></b></h4> 

> Acc√©dez √† l'aide de la fonction `rnorm`

## Editer des rapports avec Rmarkdown

L'extension [**Rmarkdown**](https://rmarkdown.rstudio.com/index.html){target="_blank"} permet de cr√©er des documents dans diff√©rents formats (html, pdf, docx, slides, ...) qui contiennent du texte, du code (en R mais pas que!), les r√©sultats, ...
Par exemple, les sujets de TP de ce cours sont r√©dig√©s en Rmarkdown.  
Vous devrez √©galement r√©diger le rapport de votre projet en Rmarkdown. 
Nous allons donner ici des √©l√©ments de base pour la cr√©ation de documents avec Rmarkdown. Pour plus de d√©tails, vous pouvez consulter l'aide m√©moire de Rmarkdown (accessible via `Help -> Cheatsheets -> Rmarkdown Cheat Sheet`) et le livre en ligne  [R Markdown: The Definitive Guide](https://bookdown.org/yihui/rmarkdown/){target="_blank"} de Y. Xie, J. J. Allaire, G. Grolemund.  

### Etapes de cr√©ation d'un document

Un document Rmarkdown est un fichier enregistr√© avec l'extension `.Rmd`. Pour cr√©er un nouveau document, allez dans `File-> NewFile-> Rmarkdown...` (ou cliquez sur l'icone nouveau document et choisissez Rmarkdown). 

<h4><b><p style="color:blue;">Exercice :</p></b></h4> 

> Cr√©ez un nouveau document Rmarkdown au format pdf avec le titre et l'auteur de votre choix. 
> Vous pouvez constater qu'un nouveau document pr√©rempli vient de s'ouvrir dans RStudio. 
> Nous allons maintenant d√©tailler le contenu de ce document. 

Un document Rmarkdown d√©bute toujours par **l'en-t√™te** qui est encadr√© par 3 tirets `---`.
Cet en-t√™te contient au moins les m√©tadonn√©es du document suivantes : le titre, l'auteur, la date, le format de sortie (`output`). 
On peut pr√©ciser des options au document final en ajoutant des sous-options √† droite du `output`. Il est √©galement possible de sp√©cifier des options diff√©rentes selon les formats. 
Voici une liste avec quelques √©l√©ments :

+ `number_section : true` permet de num√©roter les sections
+ `highlight` permet de sp√©cifier le style syntaxique (par ex `default`, `tango`, `pygments`, `kate`, ...). 
+ on peut ajouter son propre fichier de style .css avec l'option `css`
+ on peut pr√©ciser des options concernant les figures avec `fig_width`, `fig_height`, `fig_caption`, `dev`, ...
+ on peut ajouter une bibliographie √† partir d'un fichier `.bib` avec l'option `bibliography`

On a ensuite le corps du document qui peut contenir 

+ du texte selon la syntaxe markdown 
+ des blocs de code (appel√©s *chunks*) en R, Python, ... 
+ des formules math√©matiques (√©crites en latex entre `$ ... $`)
+ des images, tableaux, r√©f√©rences, ....

Vous pouvez compiler √† tout moment le document Rmarkdown en cliquant sur le bouton `Knit`. Un onglet R Markdown s‚Äôouvre alors dans la m√™me zone que l'onglet *Console* pour indiquer la progression de la compilation et les messages d'erreur √©ventuels. Une fois la compilation effectu√©e, le document obtenu s'ouvre et vous pouvez admirer le rendu. 

**Remarque**: Pour la compilation d'un document en pdf, il est n√©cessaire d'avoir install√© un compilateur de Latex sur son ordinateur. 

<h4><b><p style="color:blue;">Exercice :</p></b></h4> 

> Modifiez les options dans l'en-t√™te de votre fichier Rmarkdown puis compilez le document pour constater l'impact sur le document g√©n√©r√©.


### Quelques √©l√©ments markdown {#sectMarkdown}

Le texte d'un document Rmarkdown est r√©gi par le langage markdown. 
Regardez les quelques √©l√©ments de syntaxe et de mise en forme 
disponible [ici](https://rstudio.github.io/cheatsheets/html/rmarkdown.html?_gl=1*1t61k1h*_ga*MTY5MTU0NjIwNS4xNzI5MDc4NDE1*_ga_2C0WZ1JHG0*MTcyOTA3ODQxNC4xLjEuMTcyOTA3ODQzMC4wLjAuMA..#write-with-markdown){target="_blank"} ou consulter l'aide m√©moire de Rmarkdown (accessible via `Help -> Cheatsheets -> Rmarkdown Cheat Sheet`). 

**Remarque: ** Si vous avez organis√© votre document avec des sections / sous-sections en faisant d√©buter une ligne par un ou plusieurs `#`, alors vous pouvez cliquer sur l'icone `Outline` √† droite de la barre d'outils associ√©e au fichier R Markdown pour visualiser la table des mati√®res g√©n√©r√©e automatiquement qui vous permet de naviguer facilement dans le document. 

Pour ins√©rer du code dans un document Rmarkdown, on utilise des blocs appel√©s **chunk**. Pour cela, il suffit de cliquer sur l'icone d'insertion d'un chunk  dans la barre d'outils d'un document Rmarkdown. Il est possible d'ins√©rer un chunk de code R mais pas seulement (par exemple on peut ins√©rer du code Python). Pour du code R, un chunk de la forme $\textrm{```{r} .... ```}$ s'ins√®re alors dans le document.
On peut alors saisir du code R dans ce chunk. On peut ajouter un nom √† un bloc et pr√©ciser des options dans les accolades `{r nomdubloc, ....}`, par exemple

+ eval (TRUE par d√©faut, ou FALSE) : d√©termine si le code R doit √™tre √©valu√© ou non,
+ echo (TRUE par d√©faut, ou FALSE) : d√©termine si le code R doit √™tre affich√© ou non,
+ results ('markup' par d√©faut, 'hide', 'hold' ou 'asis') : d√©termine comment les sorties doivent √™tre affich√©es,
+ error (FALSE par d√©faut, ou TRUE) : d√©termine si les messages d'erreur doivent √™tre affich√©e,
+ warning (TRUE par d√©faut, ou FALSE) : d√©termine si les messages d'avertissement doivent √™tre affich√©es.

Ces options peuvent √™tre modifi√©es manuellement ou en utilisant l'interface graphique (en cliquant sur l'icone d'engrenage situ√© en haut √† droite de chaque bloc). 

<h4><b><p style="color:blue;">Exercice :</p></b></h4> 

> - Ajoutez `# Titre 1` avant `## RMarkdown`
> - Modifiez ```{r cars}``` en ```{r cars, eval=F}```
> - Compilez le document pour voir les diff√©rences


De mani√®re g√©n√©rale, il est recommand√© de

  - travailler dans le document R Markdown (en lan√ßant balise R par balise
R, avec la petite fl√®che verte en haut √† droite de chaque bloc, ou en
lan√ßant la ligne de code contenant le curseur en tapant Ctrl Enter),
  - commenter les r√©sultats obtenus (en dehors des balises R) au fur et √†
mesure,
  - ne compiler le document (Knit) qu‚Äô√† la fin.

**Pour la suite du TP, r√©cup√©rez sur moodle le document "TP1-InitR.Rmd", sauvegardez-le dans votre dossier de travail et ouvre-le dans RStudio. C'est le document .Rmd qui a g√©n√©r√© cet √©nonc√© de TP et que vous allez compl√©ter dans la suite.**


#	Structure des objets en R

Sous R, les √©l√©ments de base sont des objets : des donn√©es (vecteurs,
matrices, ...), des fonctions, des graphiques, ...
Ces objets se diff√©rencient par leur mode d√©crivant leur contenu, et leur classe d√©crivant leur structure. Les classes d'objets les plus courantes sont : **vector, matrix, array, factor, data.frame, list.**
On peut avoir des vecteurs, matrices, tableaux, ... de mode **null** (objet vide), **logical** (TRUE, FALSE, NA), **numeric**, **complex**, **character**. Par contre
les listes et les tableaux peuvent √™tre compos√©s d'√©l√©ments h√©t√©rog√®nes. On utilise la commande `class()` pour conna√Ætre la classe d'un objet et `str()`pour connaitre la nature des √©l√©ments composant l'objet.  

Nous allons dans ce TP pr√©senter certains de ces objets, les op√©rations et manipulations basiques que l'on peut faire, ...

Remarque : On stocke un objet dans une variable *a* √† l'aide de `a<- ...` ou `a= ...`. Pour lister les variables actuellement disponibles dans la session de travail, on utilise la fonction `ls()`. Pour effacer une ou plusieurs variables, on utilise la fonction `rm()`. La commande `rm(list=ls())` permet d'effacer toutes les variables en m√©moire. 


##	Op√©ration sur les scalaires {.tabset}

### Op√©rations 
Les op√©rations √©l√©mentaires sur les scalaires sont `*`,`-`, `+`, `/`, `^`.\

Executez les commandes suivantes. Vous chercherez en particulier √† bien identifier les diff√©rents types de donn√©es :
```{r, echo=T,eval=F}
2+2
exp(10)
#a = log(2)
a = 2
a
#b =cos(10)
b = 1
b
a - b
a*b
d <- 2 < 3
d
dd <- FALSE
dd - d
dd + d
e<- "toto"
class(e)
str(e)
```

```{r,echo=F}
rm(a,b,d,dd,e)
```

### `is.xxx()/as.xxx()`
Pour tester si un objet *obj* est de type *xxx*, on utilise la commande 
`is.xxx(obj)`. On peut aussi contraindre si possible l'objet *obj* au type *xxx* avec la commande `as.xxx(obj)`.

```{r}
a = 4.3
is.numeric(a)
is.complex(a)
is.character(a)
as.character(a)
b<- "toto"
is.numeric(b)
as.list(b)
```

```{r,echo=F}
rm(a,b)
```

### Arrondir
Pour obtenir des valeurs arrondies sur des valeurs num√©riques, vous pouvez utiliser l'une des commandes suivantes `round()`, `ceiling()`, `floor()`, `trunc()` ou `signif()` (voir l'aide `?round`). 
Comparez les codes suivantes:

```{r}
a=1.35788
floor(a)
ceiling(a)
round(a,digits=2)
signif(a,digits=4)
is.integer(floor(a))
is.numeric(floor(a))
```


##	Bool√©ens et op√©rations logiques {.tabset}

En R, un bool√©en est repr√©sent√© par *TRUE* ou *FALSE*. Les op√©rations logiques, `<`, `>`, `<=`, `>=`, `!=` (diff√©rent), `==` (√©gal) retournent *TRUE* ou *FALSE*. On peut d√©finir plusieurs conditions √† remplir avec les op√©rateurs `&` (ET) et `|` (OU).

Attention, R consid√®re que le bool√©en *FALSE* vaut $0$ et le bool√©en *TRUE* vaut $1$. Il est donc capable d'√©valuer ` TRUE + 5` bien qu'en toute logique, cela n'a aucun sens!

Voici quelques exemples de manipulation des bool√©ens pour comprendre :

```{r}
a = 3
b = 6
a<=b
a!=b
(b-2==a) & (b>=a)
(b==a) | (b>=a)
```

```{r,echo=F}
rm(a,b)
```

##	Vecteurs *(vector)*{.tabset}

Un vecteur est un ensemble ordonn√© d'√©l√©ments de m√™me nature (num√©rique, logique ou alphanum√©rique). La cr√©ation d'un vecteur peut se faire par la commande `c(e1,e2,...)`. On peut √©galement g√©n√©rer une s√©quence avec la commande `seq(a,b,t)` o√π $a$ est le premier terme, le dernier terme est $\leq b$ et le pas est $t$. Pour cr√©er un vecteur constitu√© de l'√©l√©ment $x$ r√©p√©t√© $n$ fois, on utilise la commande `rep(x,n)`. 


On donne ici quelques exemples √† tester sous R pour vous familiariser avec les vecteurs. En particulier, vous pouvez d√©couvrir des fonctions utiles avec les vecteurs comme `length()`, `sum()`, `sort()`, ... , les op√©rations usuelles, l'extraction d'√©l√©ments d'un vecteur, ...  

### Commande `c(...)`
```{r}
d <- c(2,3,5,8,4,6)
d
is.vector(d)
c(2,5,"toto")
1:10
```

### Commande `seq(...)`
```{r}
seq(1,10)
seq(from=1,to=20,by=2) 
seq(1,20,by=5)
seq(1,20,length=5)
```

### Commande `rep(...)`
```{r}
rep(5,times=10)
rep(c(1,2),3)
rep(c(1,2),each=3)
```

### Extraire des √©l√©ments
```{r}
d
d[2]
d[2:3]
d[c(1,3,6)]
d[-3]
d[-(1:2)]
```

### Op√©rations

Additionner ou soustraire un scalaire d'un vecteur
```{r}
d+4
d-4
```
Multiplier ou diviser un vecteur par un scalaire
```{r}
2*d
d/3
```
Multiplier/ diviser deux vecteurs terme √† terme
```{r}
e<- rep(2,6)
d*e
d/e
```

### Fonctions usuelles
```{r}
d = c(2,3,5,8,4,6)
d
```

Longueur d'un vecteur  
```{r} 
length(d)
```
Somme des termes d'un vecteur num√©rique
```{r} 
sum(d)
```
Somme des termes cumul√©s d'un vecteur num√©rique
```{r}
cumsum(d)
```
Diff√©rence des termes successifs d'un vecteur num√©rique
```{r}
diff(d)
```
V√©rifier si *d* est un vecteur 
```{r} 
is.vector(d)
```

Autres fonctions int√©ressantes avec les vecteurs : `abs()`, `sort()`, `order()`, `which()`, ... 
```{r}
a<-c(3,-1,5,2,-7,3,9)
abs(a)
sort(a)
order(a)
which(a<0)
```

On peut appliquer une fonction √† tous les √©l√©ments d'un vecteur facilement. 

```{r}
cos(a)
```

```{r,echo=F}
rm(a)
```

### Exercice
> Construire
>
>  + le vecteur $a$ constitu√© des entiers pairs jusqu'√† 30
>  + le vecteur $b$ contenant 6 chiffres compris entre 4 et 30 avec un intervalle constant.
>  + le vecteur $c$ contenant la somme des √©l√©ments de $b$, la longueur de $a$ et  5 fois le chiffre 3.
>
> Extraire du vecteur $c$ le  
>
>   + le quatri√®me √©l√©ment
>   + tous les √©l√©ments sauf le quatri√®me
>   + tous les √©l√©ments sup√©rieurs √† 10


```{r}
a = seq(0,30,2)
b = seq(4,30,length=6)
c = c(sum(b),length(a),3,3,3,3,3)

c[4]
c[-4]
c[which(c>10)]
```


##	Matrices (*matrix*){.tabset}

Comme les vecteurs, les matrices sont de mode quelconque mais ne contiennent que des √©l√©ments de m√™me nature. Pour cr√©er une matrice, on utilise la commande `matrix(vec,nrow=n,ncol=p)` o√π *vec* est le vecteur contenant les √©l√©ments de la matrice de taille $n$ par $p$, qui seront rang√©s en colonne sauf si l'option *byrow=T* est utilis√©e.

On donne ici quelques exemples √† tester sous R pour vous familiariser avec les matrices. En particulier, vous pouvez d√©couvrir des fonctions utiles avec les matrices comme `dim()`, `t()`, `cbind()`, `rbind()`... , les op√©rations usuelles dont la diff√©rence entre `A*B` et `A%*%B`, l'extraction d'√©l√©ments d'une matrice, ...  

### `matrix()`
```{r}
A = matrix(1:15,ncol=5)
A

B = matrix(1:15,nc=5,byrow=T)
B2 = B
B2[1,1]="toto"
B2
```

```{r}
rownames(A)=c(paste("ligne",1:3,sep=""))
A
```

### Extraire
```{r}
A
A[1,3]
A[,2]
A[2,]
A[1:3,c(2,5)]
A[1:3,-c(2,5)]
```

### `cbind() / rbind()`
Pour concat√©ner deux matrices, on peut utiliser les fonctions `rbind()` ou `cbind()`. 

```{r}
A
B
cbind(A,B)
rbind(A,B)
```

### Fonctions utiles

Dimension d'une matrice
```{r}
dim(A)
```
Nombre de lignes et de colonnes
```{r}
nrow(A)
ncol(A)
```
Transpos√©e et d√©terminant d'une matrice
```{r}
t(A)
det(A[,3:5])
```

Matrice diagonale et diagonale d'une matrice
```{r}
diag(A)
diag(1:5)
```

Matrice de bool√©ens
```{r}
A>5
A[A<5]<-0
A
```

Quelques autres fonctions sur les matrices
```{r}
colSums(A)
apply(A,2,sum)
rowSums(A)
apply(A,1,sum)
rowMeans(A)
apply(A,1,mean)
apply(A,1,max)
```

Remarque : on reverra dans la section [Programmation](#secProg) la fonction `apply()` qui permet en particulier d'√©viter les boucles *for*.\

### Op√©rations

Attention √† la multiplication matricielle `%*%` et la multiplication terme √† terme `*`!

Op√©rations terme √† terme de 2 matrices
```{r}
A+B
A*B
```

Multiplication de matrices
```{r}
t(B) %*%A
```

Multiplication par un scalaire
```{r}
5*A
```

### Exercice 

> 1. Cr√©er la matrice $A=\left(\begin{array}{c c c } 3 & 3 & 3\\ 4 & 4 & 4\\ 5 & 5 & 5\end{array}\right).$
> 2. Ajouter 2 √† tous les √©l√©ments de $A$.
> 3. Cr√©er la matrice $B$ en ajoutant la ligne $(1,2,3)$ √† $A$, puis la colonne $(1,1,1,1)'$. D√©terminer la dimension de $B$.
> 4. Extraire de $B$ la sous-matrice $C$ compos√©e des deux premi√®res colonnes et des deux derni√®res lignes. Calculer la transpos√©e et le d√©terminant de $C$. 


```{r}
A = matrix(rep(3:5,each=3),ncol=3, byrow=TRUE)
mat2 = matrix(rep(2,9),ncol=3)
A = A+mat2
B = rbind(A,1:3)
B = cbind(B,rep(1,4))
A
B
A[4:5,c(0,2)]

```


##	Listes *(list)* {.tabset #secList}

Une liste est une collection ordonn√©e d'objets qui peuvent √™tre de nature diff√©rente. Les listes sont
en particulier utilis√©es par certaines fonctions (cf section [Programmation](#secProg)) pour renvoyer des r√©sultats complexes sous
forme d'un seul objet.
On utilise la fonction `list(nom1=el1,nom2=el2,...)` (l'utilisation
des noms √©tant facultative) pour g√©n√©rer une liste. On peut acc√©der √† chaque √©l√©ment de la liste √† l'aide
de son index entre double crochets `  [[...]]`, ou par son nom pr√©c√©d√© du signe `$`.


### `list(...)`
```{r}
x = list("toto",1:8)
x
```

Cr√©ation d'une liste avec des noms aux √©l√©ments
```{r}
y = list(matrice=matrix(1:15,ncol=5),
         vecteur=seq(1,20,by=5),
         texte="toto",scalaire=8)
y
```

### Extraction
Extraction d'un √©l√©ment par son num√©ro 
```{r}
x[[1]]
```

Attention, cette commande n'est pas possible: 
```{r, eval=F}
x[[1]]+1
```

par contre celle-ci est possible
```{r}
x[[2]]+10
```

```{r}
y[[1]]
y$matrice
y$vec
y[c("texte","scalaire")]
```

### Fonctions utiles

```{r}
names(y)
length(y)
length(y$vecteur)
cos(y$scal)+y[[2]][1]
summary(y)
```


### Exercice 

> 1. Cr√©er une liste contenant le nom de trois mati√®res, les notes de 5 √©l√®ves pour chacune de ces mati√®res, l'√¢ge des 5 √©l√®ves et la fili√®re (PO) d'appartenance de ces 5 √©l√®ves.
> 2. R√©cup√©rer les notes du 4√®me √©l√®ve
> 3. Cr√©er une matrice contenant les notes et l'√¢ge des 5 √©l√®ves.

```{r}

```

##	Data frames {.tabset}
Sous R, un data.frame est analogue √† une matrice mais le contenu des colonnes
peut √™tre ici h√©t√©rog√®ne. Un tableau de donn√©es est un ensemble de vecteurs rang√©s colonne par colonne, chaque colonne correspondant √† une variable, chaque ligne √† un individu. En particulier, lors d'√©tudes statistiques, les donn√©es √† √©tudier sont souvent repr√©sent√©es par un data.frame sous R. Pour cr√©er un tableau de donn√©es, on peut regrouper des variables de m√™me longueur √†
l'aide de la commande `data.frame(nom1=var1,nom2=var2,...)`. On peut par exemple transformer une matrice en un tableau de donn√©es en utilisant la commande `as.data.frame(mat)`.


On donne ici quelques exemples √† tester sous R pour vous familiariser avec les data.frames. En particulier, vous pouvez d√©couvrir des fonctions utiles dont `summary()` et `head()`. 

### `data.frame()`
```{r}
# Cr√©ation du data.frame H
taille = runif(12,150,180)
masse = runif(12,50,90)
sexe = rep(c("M","F","F","M"),3)
H = data.frame(taille,masse,sexe)
H
class(H)
```

### `summary()/head()`
La fonction `summary()` permet de r√©sumer le contenu des diff√©rentes colonnes d'un data.frame.
```{r}
summary(H)
```
La fonction `head()` permet de visualiser les premi√®res lignes d'un data.frame
```{r}
head(H)
```

### data.frame / list/matrix
Au travers de ces quelques commandes, vous pouvez voir les analogies entre data.frame, list et matrix mais restez prudent sur la nature de l'objet que vous manipulez!
```{r}
#H[1,]
H$taille
H$sexe
is.data.frame(H)
is.matrix(H)
MH = as.matrix(H)
MH
summary(MH)
as.list(H)
```


### Exercice 

> On reprend le data.frame $H$. 
>
>1. Extraire la masse des individus dont la taille est sup√©rieure √† 160.
>2. Extraire la masse et le sexe de ces m√™mes individus.
>3. Extraire la taille des individus de sexe masculin dont la masse est inf√©rieure √† 80 (c'est possible en une seule ligne avec `&`).


```{r}
as.matrix(H)[which(taille>160)]

as.matrix(H$masse)[which(taille>160)]
as.matrix(H$sexe)[which(taille>160)]

```

# Les graphiques avec R

R contient de base des fonctions d√©di√©es aux graphiques. 
Les fonctions graphiques principales comme `plot()` ouvrent une nouvelle fen√™tre √† l'execution. Les fonctions graphiques secondaires permettent d'ajouter des √©l√©ments √† un graphique. Une pr√©sentation succinte des graphiques de base avec R est disponible [ici (tutoriel "Premiers Graphiques")](https://cmaugis.github.io/TutorielsR/Part2-InitR.html#premiers-graphiques){target="_blank"}. 

Maintenant il est plus usuel d'utiliser la librairie `ggplot2` pour faire des graphiques sous R. On d√©couvrira les graphiques avec ggplot dans le TP2. 


# Programmation avec R {#secProg}

Cette partie est consacr√©e √† la cr√©ation des fonctions, les instructions de contr√¥le, la syntaxe des it√©rations et la fonction `apply()` (et ses d√©riv√©es).

##	Cr√©er une fonction
Il est possible sous R de construire ses propres fonctions. De mani√®re g√©n√©rale, la d√©finition d'une nouvelle fonction passe par l'expression suivante :

```{r,eval=F}
nomfonction=function(arg1[=exp1],arg2[=exp2],...){
    bloc d instructions
    sortie = ...
    return(sortie)
}
```

Les accolades signalent le d√©but et la fin du code source de la fonction, les crochets indiquent le caract√®re facultatif des valeurs par d√©faut des arguments.
L'objet *sortie* contient le ou les r√©sultats retourn√©s par la fonction, on peut en particulier utiliser une liste pour retourner plusieurs r√©sultats.

Voici quelques exemples :

```{r}
MaFonction=function(x){x+2}
MaFonction(3)
```

```{r}
Fonction2=function(a,b=7){a+b}
Fonction2(2,b=3)
Fonction2(5)
```

Fonction retournant le p√©rim√®tre et la surface d'un cercle √† partir de son rayon :
```{r}
CalculsCercle=function(r){
    p=2*pi*r
    s=pi*r*r
    resultats = list(perimetre=p,surface=s)
    return(resultats)
}
res=CalculsCercle(3)
res
res$surf
```

##	Structures de contr√¥le et it√©rations

### Instructions conditionnelles
La syntaxe `if(condition){instructions}` permet de calculer les instructions uniquement si la condition est vraie.
Le code `if(condition){ A }else { B }` calcule les instructions A si la condition est vraie et les instructions B sinon. On peut √©galement utiliser `ifelse`.

Dans l'exemple suivant, les deux commandes sont √©quivalentes :

```{r,eval=F}
if(x>0){y=x*log(x)}else{ y=0}
y=ifelse(x>0,x*log(x),0)
```


### It√©rations
On utilise les boucles pour ex√©cuter plusieurs fois une instruction ou un bloc d'instructions. Les trois types de boucle sont :

- la boucle **for** :
    `for(var in seq){ commandes }`
- la boucle **while** :
    `while(cond){ commandes }`
- la boucle **repeat** :
    `repeat { commandes ; if (cond) break }`

Pour illustrer les trois types de boucles, on a cod√© de trois fa√ßons diff√©rentes la somme des √©l√©ments d'un vecteur `x` ce qui correspond √† la fonction `sum()` de R. 

```{r}
# Exemple boucle for
somme1=function(x){
t = 0
for (i in 1:length(x)){
  t = t+x[i]
}
return(t)
}

x = seq(1:10)
somme1(x)
sum(x)
```

```{r}
# Exemple boucle while
somme2=function(x){
t = 0
i = 1
while (i<=length(x)){
t = t+x[i]
i = i+1
}
return(t)
}
somme2(x)
```


```{r}
# Exemple repeat
somme3=function(x){
t = 0
i = 1
repeat{
t = t+x[i]
i = i+1
if (i> length(x)) break
}
return(t)
}
somme3(x)
```

<h4><b><p style="color:blue;">Exercice :</p></b></h4> 

> 1. √âcrire une fonction *ma.var* qui calcule la variance empirique corrig√©e pour un vecteur $x = (x_1, . . . , x_n)$. Quelle est la variance de la variable "Taille" dans le data.frame $H$ ? Comparez avec la fonction pr√©d√©finie `var()`.
> 2. √âcrire une fonction qui calcule les $n$ premiers termes de la suite de Fibonacci ($u_1=0, u_2=1, \forall n>2, u_n=u_{n-1}+u_{n-2}$)


```{r}
#  A COMPLETER POUR REPONDRE A L'EXERCICE
```

##	`apply()` et  ses variantes 

Il est recommand√© d'√©viter les boucles tr√®s chronophages. On peut utiliser pour cela la fonction `apply()` et ses variantes `sapply()`, `lapply()`, `tapply()` sur des vecteurs ou matrices.

La fonction `apply()` permet d'appliquer la m√™me fonction *FUN* sur toutes
les lignes *(MARGIN=1)* ou les colonnes *(MARGIN=2)* d'une matrice *MAT* : `apply(MAT , MARGIN, FUN)`.

Les fonctions `lapply()` et `sapply()` calculent la m√™me fonction sur tous les √©l√©ments d'un vecteur ou d'une liste.
La commande `lapply(X,FUN, ARG.COMMUN)` permet d'appliquer la fonction *FUN* √† tous les √©l√©ments du vecteur ou de la liste *X*. Les valeurs de *X* sont affect√©es au premier argument de la fonction *FUN*. Si la fonction *FUN* a plusieurs param√®tres d'entr√©e, ils sont sp√©cifi√©s dans *ARG.COMMUN*. Cette fonction retourne le r√©sultat sous la forme de listes. `sapply()` est une fonction similaire √† `lapply()` mais le r√©sultat est retourn√© sous forme de vecteurs, si possible.

La fonction `tapply()` applique une fonction *FUN* sur les sous-groupes d'un
vecteur *X* d√©finis par une variable de type factor *GRP* : `tapply(X,GRP,FUN,...)`.

Voici quelques exemples : 

```{r}
data(iris)
head(iris)
apply(iris[,1:4],2,sum)
apply(iris[,1:4],1,sum)
lapply(iris[,1:4],sum)
sapply(iris[,1:4],sum)
tapply(iris[,1],iris[,5],sum)
```

<h4><b><p style="color:blue;">Exercice :</p></b></h4>

Soit la fonction suivante :
```{r,eval=F}
Exo1=function(M){
  res=rep(0,5)
  for (i in 1:5){
    tmp=0
    for (j in 1:4) {tmp = tmp + M[i,j]}
    res[i]=tmp
  }
return(res)
}

M=matrix(1:20,nrow=5,ncol=4)
Exo1(M)
```

> Proposez une fonction √©quivalente sans aucune boucle. 

```{r}
# A COMPLETER
```

# Lois de probabilit√© sous R

Le logiciel R permet d‚Äôeffectuer des calculs avec toutes les lois de probabilit√©
usuelles, et aussi de simuler des √©chantillons issus de ces lois. 
Pour chaque distribution, quatre commandes pr√©fix√©es par une des lettres **d**, **p**, **q**, **r** et suivi du nom de la distribution (`nomdist`) sont disponibles :

- dnomdist : fonction de densit√© $f_X(.)$
 pour une loi continue ou fonction de probabilit√© $\mathbb P(X=k)$ 
 pour une loi discr√®te
- pnomdist : fonction de r√©partition $F_X(.)=\mathbb P(X\leq .)$ùêπ
- qnomdist : quantiles
- rnomdist : g√©n√®re des r√©alisations al√©atoires ind√©pendantes de la distribution nomdist.

Voici une liste non exhaustive de lois de probabilit√© disponibles :

```{r,echo=F}
df<-data.frame(Loi=c("Gaussienne","Binomiale","Poisson","Uniforme continue","Exponentielle","Student","Khi-deux","Fisher"),
               nomdist=c("norm","binom","pois","unif","exp","t","chisq","f"))
knitr::kable(df,align="ll")
```

<h4><b><p style="color:blue;">Exercice :</p></b></h4>

> Simulez un √©chantillon de $n=1000$ variables al√©atoires gaussiennes de moyenne $10$ et de variance $4$
> Calculez la moyenne et la variance de l'√©chantillon. 

```{r}
# A COMPLETER
```


#	Entr√©e / Sortie

## Importation d'un jeu de donn√©es

Pour importer un tableau de donn√©es contenu dans un fichier en un data.frame, on utilise la fonction `read.table()`. Par exemple, pour un fichier nomm√© ‚ÄúTableau.txt‚Äù, on utilisera la commande `Tab1 <- read.table("Tableau.txt")` qui cr√©e un data.frame `Tab1`. La commande read.table() admet des options dont

- `header` : indique si la premi√®re ligne contient des noms de variables. Par d√©faut, la valeur de cette option est FALSE.
- `sep` : pr√©cise le s√©parateur de champ dans le fichier entre guillemets (" " par d√©faut).
- `dec` : le caract√®re utilis√© pour les d√©cimales ("." par d√©faut).

Les fonctions `read.csv()` et `read.csv2()` sont utilis√©es pour la lecture de fichiers de donn√©es au format  `.csv`.

##	Exportation 

### Exportation en un fichier de donn√©es

Si maintenant on d√©sire sauvegarder un jeu de donn√©es, on utilise la commande `write.table()`. Les principales options de cette fonction sont :

- `file` : nom du fichier dans lequel √©crire (v√©rifier le r√©pertoire courant)
- `append` : prend une valeur logique. Si TRUE, R ajoute les donn√©es dans le fichier concern√© sans effacer les pr√©c√©dentes. La valeur par d√©faut est FALSE.
- `sep` : pr√©cise le s√©parateur √† utiliser.
- `dec` : pr√©cise le caract√®re √† utiliser pour les d√©cimales.

<h4><b><p style="color:blue;">Exercice :</p></b></h4>

> Chargez le jeu de donn√©es √¨ris`disponible dans R avec la commande `data(iris)
> Sauvegardez le jeu de donn√©es dans un fichier intitul√© `SauvIris.txt` avec des ";" pour s√©parateurs.
> Importez les donn√©es du fichier `SauvIris.txt`

```{r}
# A COMPLETER
```


### Sauvegarde d'un / des objets R

R permet d‚Äôenregistrer des objets entiers, en conservant √† la fois les donn√©es contenues dans les objets et les structures des objets.

La fonction `save.image()` peut √™tre utilis√©e √† tout moment pour enregistrer une image de session, c‚Äôest √† dire l‚Äôensemble des objets dans l‚Äôenvironnement de travail d‚Äôune session R. La sauvegarde d‚Äôune image de la session vous est √©galement propos√©e lors de la fermeture de R.

La fonction `save()` permet d‚Äôenregistrer sp√©cifiquement un ou des objets dans un fichier de format .RData. Ce fichier peut √™tre √† tout moment recharg√© sous R avec la fonction `load()`. Voici un exemple :

```{r}
x <- runif(20)
y <- list(a = 1, b = TRUE, c = "oops")
save(x, y, file = "xy.RData")
load("xy.RData")
```

On peut aussi enregistrer un seul objet, sans inclure le nom de l'objet, √† l'aide de la fonction `saveRDS()`. L'objet, sauvegard√© au format `.rds` peut √™tre recharg√© avec la fonction `readRDS()`.


